#include "dangless/common/util.h"
#include "dangless/platform/mem.h"

#include "dunetest.h"

TEST_SUITE(math);

TEST_CASE(round_up) {
  EXPECT_EQUALS(ROUND_UP(0, 1000), 0);
  EXPECT_EQUALS(ROUND_UP(500, 1000), 1000);
  EXPECT_EQUALS(ROUND_UP(248, 100), 300);
  EXPECT_EQUALS(ROUND_UP(273, 5), 275);
  EXPECT_EQUALS(ROUND_UP(64, 4), 64);
}

TEST_CASE(round_down) {
  EXPECT_EQUALS(ROUND_DOWN(0, 1000), 0);
  EXPECT_EQUALS(ROUND_DOWN(500, 1000), 0);
  EXPECT_EQUALS(ROUND_DOWN(248, 100), 200);
  EXPECT_EQUALS(ROUND_DOWN(273, 5), 270);
  EXPECT_EQUALS(ROUND_DOWN(64, 4), 64);
}

TEST_CASE(pg_index) {
  EXPECT_EQUALS(PG_INDEX(666), 0);
  EXPECT_EQUALS(PG_INDEX(2601), 0);
  EXPECT_EQUALS(PG_INDEX(4095), 0);
  EXPECT_EQUALS(PG_INDEX(4096), 1);
  EXPECT_EQUALS(PG_INDEX(4097), 1);
  EXPECT_EQUALS(PG_INDEX(40960), 10);
}

TEST_CASE(num_spanned_pages) {
  EXPECT_EQUALS(NUM_SPANNED_PAGES(1000, 512), 1);
  EXPECT_EQUALS(NUM_SPANNED_PAGES(4000, 95), 1);
  EXPECT_EQUALS(NUM_SPANNED_PAGES(4000, 128), 2);
  EXPECT_EQUALS(NUM_SPANNED_PAGES(4000, 5000), 3);
  EXPECT_EQUALS(NUM_SPANNED_PAGES(0, 4095), 1);
  EXPECT_EQUALS(NUM_SPANNED_PAGES(0, 4096), 1);
  EXPECT_EQUALS(NUM_SPANNED_PAGES(0, 4100), 2);
  EXPECT_EQUALS(NUM_SPANNED_PAGES(4096, 4096), 1);
}
